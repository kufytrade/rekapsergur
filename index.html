<!--
File: Rekap Riwayat Sertifikasi Guru - responsive.html
Contains two parts in one file for convenience:
  1) index.html (front-end responsive form)
  2) Google Apps Script (Code.gs) shown below in a code block — paste into a new Apps Script project

Before using: create Google Spreadsheet and deploy the Apps Script web app (instructions included in the file). Replace placeholders: SPREADSHEET_ID and WEB_APP_URL in the front-end.
Theme: "Dapodik" (blue/white), responsive, client-side validation, auto-save to Google Spreadsheet via Apps Script.
-->

<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Rekap Riwayat Sertifikasi Guru</title>
  <style>
    /* Simple responsive Dapodik-like theme */
    :root{
      --primary:#0b63c6; /* dapodik blue */
      --muted:#6b7280;
      --card:#ffffff;
      --bg:#f3f6fb;
    }
    *{box-sizing:border-box}
    body{font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); margin:0; color:#0f172a}
    .container{max-width:920px;margin:28px auto;padding:18px}
    .card{background:var(--card);border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(11,99,198,0.06)}
    header{display:flex;gap:12px;align-items:center}
    .brand{display:flex;flex-direction:column}
    h1{margin:0;font-size:18px;color:var(--primary)}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    form{margin-top:14px;display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"], input[type="date"], select{width:100%;padding:10px;border:1px solid #e6eef9;border-radius:8px;font-size:14px}
    .full{grid-column:1/-1}
    .actions{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:12px}
    button{background:var(--primary);color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer}
    button.secondary{background:#fff;color:var(--primary);border:1px solid rgba(11,99,198,0.12)}
    .note{font-size:12px;color:var(--muted)}
    .toast{position:fixed;right:18px;bottom:18px;background:#0f5132;color:#fff;padding:10px 14px;border-radius:8px;display:none}
    @media (max-width:720px){form{grid-template-columns:1fr} .actions{justify-content:stretch}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <div style="width:54px;height:54px;border-radius:10px;background:linear-gradient(135deg,var(--primary),#246fbf);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700">DG</div>
        <div class="brand">
          <h1>Rekap Riwayat Sertifikasi Guru</h1>
          <p class="lead">Isikan data sertifikasi guru, data akan tersimpan otomatis ke Admin.</p>
        </div>
      </header>

      <form id="rekapForm" class="card" autocomplete="off">
        <div>
          <label for="nama">Nama GTK</label>
          <input id="nama" name="Nama GTK" type="text" required>
        </div>

        <div>
          <label for="nik">NIK</label>
          <input id="nik" name="NIK" type="text" inputmode="numeric" pattern="\d*" maxlength="20">
        </div>

        <div>
          <label for="nim">NIM</label>
          <input id="nim" name="NIM" type="text">
        </div>

        <div>
          <label for="noukgs">No. UKG</label>
          <input id="noukgs" name="No. UKG" type="text">
        </div>

        <div class="full">
          <label for="lptk">Nama LPTK</label>
          <input id="lptk" name="Nama LPTK" type="text">
        </div>

        <div>
          <label for="kode">Kode Lembaga Sertifikasi</label>
          <select id="kode" name="Kode Lembaga Sertifikasi">
            <option value="Kementrian Pendidikan & Kebudayaan">Kementrian Pendidikan & Kebudayaan</option>
            <option value="Kementrian Agama">Kementrian Agama</option>
          </select>
        </div>

        <div>
          <label for="bidang">Nama Bidang Studi</label>
          <input id="bidang" name="Nama Bidang Studi" type="text">
        </div>

        <div>
          <label for="nosert">Nomor Sertifikat Pendidik</label>
          <input id="nosert" name="Nomor Sertifikat Pendidik" type="text">
        </div>

        <div>
          <label for="tgl">Tanggal Sertifikat</label>
          <input id="tgl" name="Tanggal Sertifikat" type="date">
        </div>

        <div class="full actions">
          <div style="flex:1">
            <span class="note">kufytrade@2025</span>
          </div>
          <button type="button" id="saveBtn">Simpan</button>
          <button type="button" id="clearBtn" class="secondary">Bersihkan</button>
        </div>
      </form>

    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // ----- CONFIG: replace with your deployed Apps Script web app URL -----
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzRZsNS16Hxb9f9iGm_AZOEpYKcxO3UdHfKR4wnrfW4JJcldj7UxQeeu1o3tU8QOoWJ/exec';
    // ---------------------------------------------------------------------

    const form = document.getElementById('rekapForm');
    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clearBtn');
    const toast = document.getElementById('toast');

    function showToast(msg, ms=3500){ toast.textContent = msg; toast.style.display = 'block'; setTimeout(()=>toast.style.display='none', ms); }

    function collectData(){
      const fm = new FormData(form);
      const obj = {};
      for(const [k,v] of fm.entries()) obj[k] = v;
      // normalize date to yyyy-mm-dd (if present)
      if(obj['Tanggal Sertifikat']){
        // ensure format
        const d = new Date(obj['Tanggal Sertifikat']);
        if(!isNaN(d)){
          const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0');
          obj['Tanggal Sertifikat'] = `${y}-${m}-${day}`;
        }
      }
      return obj;
    }

    async function postToSheet(payload){
      if(WEB_APP_URL.startsWith('REPLACE')){
        showToast('ERROR: Ganti WEB_APP_URL di script sebelum mengirim.');
        throw new Error('WEB_APP_URL not configured');
      }
      const res = await fetch(WEB_APP_URL, {
        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('Network response was not ok');
      return res.json();
    }

    saveBtn.addEventListener('click', async ()=>{
      try{
        saveBtn.disabled = true;
        const data = collectData();
        // basic validation: Nama GTK required
        if(!data['Nama GTK'] || data['Nama GTK'].trim()===''){ showToast('Nama GTK wajib diisi'); saveBtn.disabled=false; return; }
        showToast('Mengirim data...');
        const resp = await postToSheet(data);
        if(resp && resp.result==='success'){
          showToast('Tersimpan ✓');
          form.reset();
        } else {
          showToast('Gagal menyimpan — lihat konsol.');
          console.error('Response:', resp);
        }
      }catch(err){
        console.error(err);
        showToast('Terjadi kesalahan: ' + (err.message||err));
      }finally{ saveBtn.disabled=false; }
    });

    clearBtn.addEventListener('click', ()=>{ if(confirm('Bersihkan semua input?')) form.reset(); });

    // Optional: auto-save on form change (debounced)
    let timer;
    form.addEventListener('input', ()=>{
      clearTimeout(timer);
      timer = setTimeout(async ()=>{
        const data = collectData();
        // only auto-save when Nama GTK present to avoid empty rows
        if(data['Nama GTK'] && data['Nama GTK'].trim()!==""){
          try{ await postToSheet(Object.assign({_auto:'true'}, data)); console.log('Auto-saved'); } catch(e){ console.log('Auto-save failed', e); }
        }
      }, 1500);
    });
  </script>

  <!--
  -------------------- GOOGLE APPS SCRIPT (Code.gs) --------------------
  Paste this into a new Google Apps Script project (replace SPREADSHEET_ID),
  then Deploy -> New deployment -> Web app -> 'Execute as: Me', 'Who has access: Anyone'
  Copy the web app URL and paste into WEB_APP_URL constant above.
  ---------------------------------------------------------------------
  -->

  <script type="text/plain" id="code-gs">
  // Code.gs
  const SPREADSHEET_ID = '174AKi3aME8csmnN-hVlnd-7OUQwqb2TiWQiAKOe3z10'; // e.g. from spreadsheet URL

  function doGet(e){
    return ContentService.createTextOutput(JSON.stringify({status:'ok', message:'Web app ready'})).setMimeType(ContentService.MimeType.JSON);
  }

  function doPost(e){
    try{
      // Accept JSON body
      const body = e.postData && e.postData.type === 'application/json' ? JSON.parse(e.postData.contents) : e.parameter;

      const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
      const sheet = ss.getSheetByName('Rekap') || ss.insertSheet('Rekap');

      // Header row (create if sheet is empty)
      const headers = ['Timestamp','Nama GTK','NIK','NIM','No. UKG','Nama LPTK','Kode Lembaga Sertifikasi','Nama Bidang Studi','Nomor Sertifikat Pendidik','Tanggal Sertifikat','_auto'];
      if(sheet.getLastRow() === 0){ sheet.appendRow(headers); }

      const row = [new Date(),
        body['Nama GTK']||'', body['NIK']||'', body['NIM']||'', body['No. UKG']||'', body['Nama LPTK']||'', body['Kode Lembaga Sertifikasi']||'', body['Nama Bidang Studi']||'', body['Nomor Sertifikat Pendidik']||'', body['Tanggal Sertifikat']||'', body['_auto']||''
      ];

      sheet.appendRow(row);

      return ContentService.createTextOutput(JSON.stringify({result:'success'})).setMimeType(ContentService.MimeType.JSON);
    } catch(err){
      return ContentService.createTextOutput(JSON.stringify({result:'error', message:err.message})).setMimeType(ContentService.MimeType.JSON);
    }
  }
  </script>

</body>
</html>

